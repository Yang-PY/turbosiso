<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SISO: BICM.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>BICM.m</h1><a href="BICM_8m.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 %
<a name="l00002"></a>00002 % Implements BICM <span class="keyword">using</span> a turbo receiver with a SISO demapper module and a SISO NSC module.
<a name="l00003"></a>00003 %
<a name="l00004"></a>00004 % Reference: A. Tonello, <span class="stringliteral">''</span>Space-time bit-interleaved coded <a class="code" href="pccc_8m.html#13af04932cc32b8430b84bf89d4c97ea">modulation</a> with an iterative decoding strategy,`` 
<a name="l00005"></a>00005 % in Vehicular Technology Conference, vol. 1, pp. 473-478 vol.1, 2000
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 %general parameters
<a name="l00008"></a>00008 const_size = 16;%<a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">constellation</a> size
<a name="l00009"></a><a class="code" href="BICM_8m.html#622f6e6f8517b981381a1942218453ff">00009</a> <a class="code" href="BICM_8m.html#622f6e6f8517b981381a1942218453ff">select_mapping</a> = <span class="stringliteral">'binary'</span>;
<a name="l00010"></a><a class="code" href="BICM_8m.html#e6135510f2fcee68c51db5c21078e14b">00010</a> <a class="code" href="BICM_8m.html#e6135510f2fcee68c51db5c21078e14b">threshold_value</a> = 50;
<a name="l00011"></a><a class="code" href="BICM_8m.html#15def0b32a8e07c9864cf3089fd7e84e">00011</a> <a class="code" href="BICM_8m.html#15def0b32a8e07c9864cf3089fd7e84e">demapper_method</a> = <span class="stringliteral">'maxlogMAP'</span>;
<a name="l00012"></a><a class="code" href="BICM_8m.html#c44ada9f8f99e5d9f521438b2b6b7b36">00012</a> <a class="code" href="pccc_8m.html#c44ada9f8f99e5d9f521438b2b6b7b36">map_metric</a> = <span class="stringliteral">'maxlogMAP'</span>;
<a name="l00013"></a><a class="code" href="BICM_8m.html#295392d2c1465863e97d36dfd19a4b97">00013</a> <a class="code" href="pccc_8m.html#73103af02bc57db44fc54ad21c37ecd9">gen</a> = [37 21];
<a name="l00014"></a><a class="code" href="BICM_8m.html#f38d32050f42b140b07665e70757d89c">00014</a> <a class="code" href="BICM_8m.html#f38d32050f42b140b07665e70757d89c">constraint_length</a> = 5;
<a name="l00015"></a><a class="code" href="BICM_8m.html#82d6fafa7b7d03c20d6fd5e55577002d">00015</a> <a class="code" href="pccc_8m.html#2db14ef8a33e774589826a6f1e5fe516">nb_errors_lim</a> = 1500;
<a name="l00016"></a><a class="code" href="BICM_8m.html#9527c3511fa9a8a65077ca6959cf49a7">00016</a> <a class="code" href="sccc_8m.html#a6ede64af868a0712a6f0a552296fccf">nb_bits_lim</a> = 1e6;
<a name="l00017"></a><a class="code" href="BICM_8m.html#856c8163323997a4986d4b1dce4b8f35">00017</a> <a class="code" href="pccc_8m.html#8b420c46ce5570ef92f50c779dace329">perm_len</a> = pow2(14);%<a class="code" href="pccc_8m.html#0a592553caeb5919316774d98ae39046">permutation</a> length
<a name="l00018"></a><a class="code" href="BICM_8m.html#fdb38f8cf71f99a37ee7bd5b396242c9">00018</a> <a class="code" href="pccc_8m.html#be1b5217ffb43e4e6fae98a2910d9da0">nb_iter</a> = 10;%number of iterations in the turbo <a class="code" href="pccc_8m.html#5d4675ccc38f894c78ef8a732de07c85">decoder</a>
<a name="l00019"></a><a class="code" href="BICM_8m.html#6d694f812fac48ae4019b09b4527d7a5">00019</a> <a class="code" href="pccc_8m.html#bc716b49b0c9588d89d80534d0b0b8ca">EbN0_dB</a> = 0:20;
<a name="l00020"></a><a class="code" href="BICM_8m.html#cb95449a94688af33f6e9bb090cf2936">00020</a> <a class="code" href="pccc_8m.html#24ee4b5453385f9ba93ead2a9623c539">R</a> = 1/2;%coding <a class="code" href="pccc_8m.html#848fd681812403547f43b2f76540cc40">rate</a> of FEC
<a name="l00021"></a><a class="code" href="BICM_8m.html#84b7e4f5537f440cbbf66ab569334e32">00021</a> <a class="code" href="BICM_8m.html#84b7e4f5537f440cbbf66ab569334e32">Es</a> = 1;%mean symbol energy    
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 %QAM modulator <span class="keyword">class</span>
<a name="l00024"></a><a class="code" href="BICM_8m.html#556188a8fe23ce58ddab61f142b22678">00024</a> <a class="code" href="BICM_8m.html#556188a8fe23ce58ddab61f142b22678">bits_per_symbol</a> = log2(const_size);
<a name="l00025"></a><a class="code" href="BICM_8m.html#7079e572d2435b365e5acdfe73e30437">00025</a> <a class="code" href="BICM_8m.html#7079e572d2435b365e5acdfe73e30437">h_QAMmod</a> = modem.qammod(<span class="charliteral">'M'</span>, const_size, <span class="stringliteral">'PhaseOffset'</span>, 0, <span class="stringliteral">'SymbolOrder'</span>, <a class="code" href="BICM_8m.html#622f6e6f8517b981381a1942218453ff">select_mapping</a>, <span class="stringliteral">'InputType'</span>, <span class="stringliteral">'bit'</span>);
<a name="l00026"></a><a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">00026</a> <a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">constellation</a> = <a class="code" href="BICM_8m.html#7079e572d2435b365e5acdfe73e30437">h_QAMmod</a>.Constellation;%complex <a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">constellation</a>
<a name="l00027"></a><a class="code" href="BICM_8m.html#0e0c62601bce85e6d8774471314b63eb">00027</a> <a class="code" href="BICM_8m.html#0e0c62601bce85e6d8774471314b63eb">bin_constellation</a> = de2bi(<a class="code" href="BICM_8m.html#7079e572d2435b365e5acdfe73e30437">h_QAMmod</a>.SymbolMapping, <a class="code" href="BICM_8m.html#556188a8fe23ce58ddab61f142b22678">bits_per_symbol</a>, <span class="stringliteral">'left-msb'</span>);%binary <a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">constellation</a>
<a name="l00028"></a><a class="code" href="BICM_8m.html#4b78049398be410e91e0c1f98c372aa0">00028</a> <a class="code" href="BICM_8m.html#4b78049398be410e91e0c1f98c372aa0">scale</a> = modnorm(<a class="code" href="BICM_8m.html#c6a0ccc22ebe2b35aed5f83ec9204bdd">constellation</a>, <span class="stringliteral">'avpow'</span>, 1);%normalisation factor    
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 %other parameters
<a name="l00031"></a><a class="code" href="BICM_8m.html#681d00d5d1ca7b4773b641774be8ec89">00031</a> <a class="code" href="pccc_8m.html#2ff994e16bf9521154de4cf659a3b689">filename</a> = ['Res/BICM_' map_metric '_' select_mapping];
<a name="l00032"></a><a class="code" href="BICM_8m.html#d40b1b0249989a08d8a1a510635905d7">00032</a> <a class="code" href="BICM_8m.html#d40b1b0249989a08d8a1a510635905d7">nb_symb</a> = <a class="code" href="pccc_8m.html#8b420c46ce5570ef92f50c779dace329">perm_len</a>/<a class="code" href="BICM_8m.html#556188a8fe23ce58ddab61f142b22678">bits_per_symbol</a>;
<a name="l00033"></a><a class="code" href="BICM_8m.html#307e2c9b85840929dc662c4bb55bc0ee">00033</a> <a class="code" href="BICM_8m.html#307e2c9b85840929dc662c4bb55bc0ee">nb_bits_tail</a> = <a class="code" href="pccc_8m.html#8b420c46ce5570ef92f50c779dace329">perm_len</a>/length(<a class="code" href="pccc_8m.html#73103af02bc57db44fc54ad21c37ecd9">gen</a>);
<a name="l00034"></a><a class="code" href="BICM_8m.html#590feebedbb1efacea3adb1d38c4ab9f">00034</a> <a class="code" href="sccc_8m.html#590feebedbb1efacea3adb1d38c4ab9f">nb_bits</a> = <a class="code" href="BICM_8m.html#307e2c9b85840929dc662c4bb55bc0ee">nb_bits_tail</a>-(<a class="code" href="BICM_8m.html#f38d32050f42b140b07665e70757d89c">constraint_length</a>-1);%number of <a class="code" href="pccc_8m.html#e0187e340c2965676e5801e8d1274c3b">bits</a> in a <a class="code" href="pccc_8m.html#71f0a2190b4d07a9c41d2681c64085c9">block</a> (without <a class="code" href="BICM_8m.html#b7e6457c76e27665f870ba871113ec1d">tail</a>)
<a name="l00035"></a>00035 <a class="code" href="pccc_8m.html#de1bd2bef086e1aa50b191df66e098ef">sigma2</a> = (0.5*<a class="code" href="BICM_8m.html#84b7e4f5537f440cbbf66ab569334e32">Es</a>/(<a class="code" href="pccc_8m.html#24ee4b5453385f9ba93ead2a9623c539">R</a>*<a class="code" href="BICM_8m.html#556188a8fe23ce58ddab61f142b22678">bits_per_symbol</a>))*(10.^(-<a class="code" href="pccc_8m.html#bc716b49b0c9588d89d80534d0b0b8ca">EbN0_dB</a>/10));%N0/2
<a name="l00036"></a>00036 %SISO NSC
<a name="l00037"></a><a class="code" href="BICM_8m.html#69fe15138973b117ea8476e0b1609427">00037</a> <a class="code" href="BICM_8m.html#69fe15138973b117ea8476e0b1609427">nsc_apriori_data</a> = zeros(1, <a class="code" href="BICM_8m.html#307e2c9b85840929dc662c4bb55bc0ee">nb_bits_tail</a>);
<a name="l00038"></a>00038 %decision
<a name="l00039"></a><a class="code" href="BICM_8m.html#87c15061f06120b1c935337c84fc65e7">00039</a> <a class="code" href="pccc_8m.html#3e0c587293fb69391a99077d4f75a10c">snr_len</a> = length(<a class="code" href="pccc_8m.html#bc716b49b0c9588d89d80534d0b0b8ca">EbN0_dB</a>);
<a name="l00040"></a><a class="code" href="BICM_8m.html#4a4e58fd295efa786eeff9ca56dffad0">00040</a> <a class="code" href="pccc_8m.html#4799e2ea2eeaf9ebc68bd4468b682670">BER</a> = zeros(<a class="code" href="pccc_8m.html#be1b5217ffb43e4e6fae98a2910d9da0">nb_iter</a>,<a class="code" href="pccc_8m.html#3e0c587293fb69391a99077d4f75a10c">snr_len</a>);
<a name="l00041"></a>00041     
<a name="l00042"></a>00042 %CC
<a name="l00043"></a><a class="code" href="BICM_8m.html#04548c1bdf427a939943c7e304f3152e">00043</a> <a class="code" href="pccc_8m.html#49a69b5721f6137c804deb5db827f20f">bin_gen</a> = de2bi(base2dec(int2str(<a class="code" href="pccc_8m.html#73103af02bc57db44fc54ad21c37ecd9">gen</a>.<span class="stringliteral">'), 8), '</span>left-msb<span class="stringliteral">');</span>
<a name="l00044"></a><a class="code" href="BICM_8m.html#313bbe9d755acc3e7b7d84c9728a12a6">00044</a> <span class="stringliteral">constraint_len = size(bin_gen, 2);</span>
<a name="l00045"></a><a class="code" href="BICM_8m.html#aae8f47a8aa66cdb8d441fc776930321">00045</a> <span class="stringliteral">trellis = poly2trellis(constraint_len, gen);</span>
<a name="l00046"></a>00046 <span class="stringliteral">    </span>
<a name="l00047"></a>00047 <span class="stringliteral">%main loop</span>
<a name="l00048"></a><a class="code" href="BICM_8m.html#7bfe56f869281663979e51c992e67fc6">00048</a> <span class="stringliteral">txtprogressbar;</span>
<a name="l00049"></a><a class="code" href="BICM_8m.html#641c8e8a1b707a8601b29dd709a417d4">00049</a> <span class="stringliteral">for en=1:snr_len</span>
<a name="l00050"></a>00050 <span class="stringliteral">        nb_errors = 0;</span>
<a name="l00051"></a><a class="code" href="BICM_8m.html#80eeae01eecaed2e3103dfaa95ffafe7">00051</a> <span class="stringliteral">        nb_blocks = 0;</span>
<a name="l00052"></a>00052 <span class="stringliteral">        while ((nb_errors&lt;nb_errors_lim) &amp;&amp; (nb_blocks*nb_bits&lt;nb_bits_lim))%if at the last iteration the nb. of errors is inferior to lim, then process another block</span>
<a name="l00053"></a>00053 <span class="stringliteral">            %permutation</span>
<a name="l00054"></a><a class="code" href="BICM_8m.html#144ff18b64812c18c1eb1ca803c13a26">00054</a> <span class="stringliteral">            perm = randperm(perm_len);</span>
<a name="l00055"></a>00055 <span class="stringliteral">            %inverse permutation</span>
<a name="l00056"></a><a class="code" href="BICM_8m.html#0a592553caeb5919316774d98ae39046">00056</a> <span class="stringliteral">            [ignore, inv_perm] = sort(perm);</span>
<a name="l00057"></a>00057 <span class="stringliteral"></span>
<a name="l00058"></a>00058 <span class="stringliteral">            %bits generation</span>
<a name="l00059"></a><a class="code" href="BICM_8m.html#e0187e340c2965676e5801e8d1274c3b">00059</a> <span class="stringliteral">            bits = randint(1, nb_bits, 2);</span>
<a name="l00060"></a>00060 <span class="stringliteral"></span>
<a name="l00061"></a>00061 <span class="stringliteral">            %convolutional code</span>
<a name="l00062"></a><a class="code" href="BICM_8m.html#0a08ab68c0f87fff46d52eceece724e2">00062</a> <span class="stringliteral">            [coded_bits, final_state] = convenc(bits, trellis, 0);%initial state is zero</span>
<a name="l00063"></a><a class="code" href="BICM_8m.html#b7e6457c76e27665f870ba871113ec1d">00063</a> <span class="stringliteral">            tail = convenc(zeros(1, constraint_length-1), trellis, final_state);%tail is added to information bits to close the trellis         </span>
<a name="l00064"></a>00064 <span class="stringliteral"></span>
<a name="l00065"></a>00065 <span class="stringliteral">            %permutation+QAM modulation</span>
<a name="l00066"></a><a class="code" href="BICM_8m.html#dfee54ce899d703a2d1e51f23724561e">00066</a> <span class="stringliteral">            temp = [coded_bits tail];</span>
<a name="l00067"></a>00067 <span class="stringliteral">            em = scale*modulate(h_QAMmod, temp(perm)'</span>).<span class="stringliteral">';            </span>
<a name="l00068"></a>00068 <span class="stringliteral">            </span>
<a name="l00069"></a>00069 <span class="stringliteral">            %flat-fading channel</span>
<a name="l00070"></a>00070 <span class="stringliteral">            ch_attenuations = sqrt(0.5)*(randn(1, nb_symb)+j*randn(1, nb_symb));</span>
<a name="l00071"></a>00071 <span class="stringliteral">            rec = ch_attenuations.*em+sqrt(sigma2(en))*(randn(1, nb_symb)+j*randn(1, nb_symb));</span>
<a name="l00072"></a>00072 <span class="stringliteral"></span>
<a name="l00073"></a>00073 <span class="stringliteral">            %turbo receiver</span>
<a name="l00074"></a>00074 <span class="stringliteral">            demod_apriori_data = zeros(1, perm_len);%a priori information of emitted bits</span>
<a name="l00075"></a>00075 <span class="stringliteral">            for n=1:nb_iter</span>
<a name="l00076"></a>00076 <span class="stringliteral">                %first decoder</span>
<a name="l00077"></a>00077 <span class="stringliteral">                demod_extrinsic_data = C_SISOdemapper(rec, demod_apriori_data, ch_attenuations, sigma2(en), bits_per_symbol, ...</span>
<a name="l00078"></a>00078 <span class="stringliteral">                    scale*constellation, bin_constellation, demapper_method);</span>
<a name="l00079"></a>00079 <span class="stringliteral">               </span>
<a name="l00080"></a>00080 <span class="stringliteral">                %deinterleave</span>
<a name="l00081"></a>00081 <span class="stringliteral">                nsc_intrinsic_coded = demod_extrinsic_data(inv_perm);</span>
<a name="l00082"></a>00082 <span class="stringliteral">                </span>
<a name="l00083"></a>00083 <span class="stringliteral">                %threshold</span>
<a name="l00084"></a>00084 <span class="stringliteral">                nsc_intrinsic_coded(nsc_intrinsic_coded&gt;threshold_value) = threshold_value;</span>
<a name="l00085"></a>00085 <span class="stringliteral">                nsc_intrinsic_coded(nsc_intrinsic_coded&lt;-threshold_value) = -threshold_value;</span>
<a name="l00086"></a>00086 <span class="stringliteral"></span>
<a name="l00087"></a>00087 <span class="stringliteral">                %second decoder</span>
<a name="l00088"></a>00088 <span class="stringliteral">                [nsc_extrinsic_coded nsc_extrinsic_data] = C_SISOnsc(nsc_intrinsic_coded, nsc_apriori_data, bin_gen, ...</span>
<a name="l00089"></a>00089 <span class="stringliteral">                    1, 1, map_metric);               </span>
<a name="l00090"></a>00090 <span class="stringliteral"></span>
<a name="l00091"></a>00091 <span class="stringliteral">                %decision</span>
<a name="l00092"></a>00092 <span class="stringliteral">                rec_bits = double(nsc_extrinsic_data&gt;0);%suppose that a priori info is zero</span>
<a name="l00093"></a>00093 <span class="stringliteral">                %count errors</span>
<a name="l00094"></a>00094 <span class="stringliteral">                BER(n,en) = BER(n,en)+nnz(bits-rec_bits(1:nb_bits))/nb_bits;</span>
<a name="l00095"></a>00095 <span class="stringliteral"></span>
<a name="l00096"></a>00096 <span class="stringliteral">                %interleave</span>
<a name="l00097"></a>00097 <span class="stringliteral">                demod_apriori_data = nsc_extrinsic_coded(perm);</span>
<a name="l00098"></a>00098 <span class="stringliteral">            end %end iterations</span>
<a name="l00099"></a>00099 <span class="stringliteral">            nb_errors = nb_errors+nnz(bits-rec_bits(1:nb_bits));%get number of errors at the last iteration</span>
<a name="l00100"></a>00100 <span class="stringliteral">            nb_blocks = nb_blocks+1;</span>
<a name="l00101"></a>00101 <span class="stringliteral">        end %end blocks (while loop)</span>
<a name="l00102"></a>00102 <span class="stringliteral"></span>
<a name="l00103"></a>00103 <span class="stringliteral">        %compute BER over all tx blocks</span>
<a name="l00104"></a>00104 <span class="stringliteral">        BER(:,en) = BER(:,en)/nb_blocks;</span>
<a name="l00105"></a>00105 <span class="stringliteral"></span>
<a name="l00106"></a>00106 <span class="stringliteral">        %show progress</span>
<a name="l00107"></a>00107 <span class="stringliteral">        txtprogressbar(en/snr_len);</span>
<a name="l00108"></a>00108 <span class="stringliteral">end</span>
<a name="l00109"></a>00109 <span class="stringliteral"></span>
<a name="l00110"></a>00110 <span class="stringliteral">save(filename, '</span>BER<span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#bc716b49b0c9588d89d80534d0b0b8ca">EbN0_dB</a><span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#73103af02bc57db44fc54ad21c37ecd9">gen</a><span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#24ee4b5453385f9ba93ead2a9623c539">R</a><span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#be1b5217ffb43e4e6fae98a2910d9da0">nb_iter</a><span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#2db14ef8a33e774589826a6f1e5fe516">nb_errors_lim</a><span class="stringliteral">', '</span><a class="code" href="sccc_8m.html#a6ede64af868a0712a6f0a552296fccf">nb_bits_lim</a><span class="stringliteral">', '</span><a class="code" href="pccc_8m.html#8b420c46ce5570ef92f50c779dace329">perm_len</a><span class="stringliteral">', '</span>const_size<span class="stringliteral">')</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
